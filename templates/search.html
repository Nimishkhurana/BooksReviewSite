<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" href="{{url_for("static",filename="search.css")}}">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js" charset="utf-8"></script>
  <!-- <script src="{{ url_for("static",filename = "search.js")}}" charset="utf-8"></script> -->
  {%raw%}
  <script id="book_card" type="text/x-handlebars-template">


    <div class="box">
      <strong>{{title}}</strong>
      <em id="author">{{{ author }}}</em>
    </div>


  </script>
  {%endraw%}

  <script type="text/javascript">
    const template = Handlebars.compile(document.querySelector('#book_card').innerHTML);

    document.addEventListener('DOMContentLoaded', function() {
          document.querySelector('form').onsubmit = function() {

            request = new XMLHttpRequest();
            request.open('POST', '/searching');
            const search_by = document.querySelector('#search_by').value;
            const search_book = document.querySelector('#search_book').value;

            const addon = new FormData();
            addon.append('search_by', search_by);
            addon.append('search_book', search_book);
            request.send(addon);

            request.onload = function() {
              document.querySelector('#books').innerHTML = '';
              const data = JSON.parse(this.responseText);

              const message = data["message"]


              document.querySelector('#message').innerHTML = message;
              if (data["success"]) {
                const titles = data["titles"]
                const authors = data["authors"]
                console.log(titles);
                for(var i=0;i<titles.length;i++)
                {
                  const content = template({"title":titles[i],"author":authors[i]});
                  document.querySelector('#books').innerHTML += content;
                }
              }
              // else {
              //   const content = data["error"];
              //   document.querySelector('#books').innerHTML += content;
              // }



            }

            return false;
          };
        });
  </script>



</head>

<body>
  <nav class="navbar navbar-dark " style="background-color: #47d8ad;">
    <a class="navbar-brand">BooksReview</a>
    <form class="form-inline" action=>
      <div class="input-group m-sm-2">
        <div class="input-group-prepend ">
          <label class="input-group-text" for="search_by">Search by:</label>
        </div>
        <select class="custom-select " id="search_by" name="search_by">
          <option selected>Choose...</option>
          <option value="isbn">ISBN No.</option>
          <option value="title">Title</option>
          <option value="author">Author</option>
          <option value="year">Year</option>
        </select>
      </div>
      <input id="search_book" name="search_book" class="form-control m-sm-2" type="search" placeholder="Search" aria-label="Search">
      <button class="btn btn-outline-primary my-2 my-sm-0" type="submit">Search Book</button>
    </form>


    <div class="nav-item dropdown navbar-right ">

      <div class="nav-link dropdown-toggle mr-auto" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        {{ username }}
      </div>
      <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
        <a class="dropdown-item" href="logout">Logout</a>

      </div>
    </div>

  </nav>

  <br>

  <strong id="message"></strong>
  <div id="books">


  </div>


</body>

</html>


<!-- &#9660; -->
